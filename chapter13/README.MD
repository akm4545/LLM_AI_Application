# **LLM 운영하기**  
LLM을 서비스에 활용하려는 시도가 늘면서 LLM을 서비스 운영 환경에서 효과적으로 통합하고 관리하기 위한 LLMOps도 함께 주목받고 있다. LLMOps는 
ML 모델의 개발과 운영에 대해 다루는 MLOps를 LLM에 맞춰 확장한 개념이다.  
  
# **MLOps**  
MLOps(Machine Learning Operations)는 데브옵스(Development and Operations, DevOps)의 개념을 머신 러닝과 데이터 과학 분야로 확장한 
방법론이다. 기존의 데브옵스가 소프트웨어 개발과 운영의 협업과 자동화에 초점을 맞췄다면 MLOps는 여기에 데이터와 머신러닝 모델이라는 두 가지 핵심 
요소를 더해 확장한 것이다. MLOps의 목표는 데이터 수집, 전처리, 모델 학습, 평가, 배포, 모니터링 등 머신러닝 프로젝트의 전 과정을 자동화하고 효율화하는 
것이다. 이를 통해 데이터 과학자와 엔지니어 간의 협업을 강화하고 모델의 품질과 안정성을 향상하며 비즈니스 가치 실현까지의 시간을 단축할 수 있다. 
  
![img.png](image/img.png)  
  
요약하자면 MLOps는 위 그림과 같이 데브옵스에 데이터와 모델을 추가한 개념이다.  
  
![img.png](image/img2.png)  
  
MLOps의 핵심은 위 그림과 같이 데이터 수집부터 전처리, 학습, 평가, 배포에 이르는 전체 과정을 자동화하고 관리하는 머신러닝 파이프라인이라고 할 수 
있다. 특히 MLOps에서는 모델의 재현성(reproducibility)을 보장하는 것이 매우 중요하다. 머신러닝 프로젝트에서 모델의 재현성이란 이전에 수행된 
ML 워크플로를 그대로 반복했을 때 동일한 모델을 얻을 수 있는지 여부를 의미한다. 모델 개발 과정의 모든 단계가 문서화되고 버전 관리되어야 이전 모델을 
동일하게 재현할 수 있다. 데이터와 모델, 코드의 버전 관리가 이뤄지고 모든 단계의 입력값과 파라미터를 추적하고 기록해야 한다. 또한 MLOps에서는 모델 
학습을 자동으로 트리거하여 새로운 데이터로 지속적으로 모델을 업데이트한다. 모델 성능 저하 시 자동으로 재학습과 배포가 이뤄지도록 함으로써 모델이 항상 
최적의 상태를 유지하도록 만든다. 이는 데브옵스의 지속적 통합/배포(CI/CD) 개념을 머신러닝에 적용한 것이다.  
  
위 그림을 기준으로 했을 때 MLOps에서는 다음과 같은 주제를 다룬다.  
  
- 데이터 관리  
- 실험 관리  
- 모델 저장소  
- 모델 모니터링  
  
# **데이터 관리**  
모델 학습을 위한 데이터 준비 과정에는 여러 가지 중요한 의사결정이 포함되고 그 의사 결정에 따라 다양한 형태의 데이터셋이 생성된다.  
  
![img.png](image/img3.png)  
  
대표적으로 위 그림과 같이 포함시킬 데이터의 범위를 선택하고 어떤 전처리 방식을 포함시킬지, 특성 공학(feature engineering)을 통해 어떤 특성을 
추가할지에 따라 학습 데이터셋이 달라진다. 예를 들어 추천 모델을 만들 때 처음에는 고객의 구매 데이터만으로 모델을 학습시키려고 했지만 구매 데이터가 
너무 적어 고객이 장바구니에 추가했거나 조회한 데이터까지 학습 데이터에 추가할 수도 있다. 학습 데이터에 포함되는 데이터의 범위를 어떻게 선택하느냐에 
따라 데이터의 크기와 의미가 달라지고 모델의 성능이나 일반화 능력에 영향을 미칠 수 있다. 데이터에 오류가 있다면 데이터를 수정하거나 제거하는 전처리를 
추가할 수 있고 카테고리 정보를 어떻게 숫자로 변환할지(예: 원핫 인코딩), 컬럼별로 값의 크기를 어떻게 조정할지(예: 최소-최대 스케일링)에 따라 최종적인 
데이터셋이 달라진다. 마지막으로 특성 공학을 통해 원천 데이터에서 어떤 특성을 추가하느냐에 따라 학습 데이터셋이 달라진다. 각각의 선택에 따라 위 그림의 
오른쪽과 같이 다양한 데이터셋이 생성된다.  
  
머신러닝 모델의 학습 과정에서 모델의 성능과 일반화 능력을 높이기 위해 다양한 시도를 하게 되고 다양한 데이터셋이 만들어진다. 모델 학습 결과를 
재현하기 위해서는 데이터셋의 버전을 관리하고 어떤 학습 데이터셋으로 모델을 학습시켰는지 기록해야 한다. 이를 위해 DVC(Data Version Control)와 
같은 도구를 사용할 수 있다.  
  
# **실험 관리**  
![img.png](image/img4.png)  
  
머신러닝 모델을 학습시킬 때는 어떤 모델을 사용할지 결정해야 한다. 예를 들어 분류 문제를 푼다고 할 때 위 그림과 같이 로지스틱 회귀, SVM, 트리 모델 같은 
머신러닝 모델부터 딥러닝 모델까지 다양한 모델을 사용할 수 있다. 또한 모델마다 성능에 영향을 주는 다양한 하이퍼파라미터가 있는데 어떤 하이퍼파라미터가 
최적인지 탐색하는 과정도 필요하다. 그나마 한 사람이 모든 실험을 진행한다면 이름 규칙을 잘 정해 엑셀이나 스프레드시트에 차근차근 정리하면서 할 수 
있겠지만 여러 사람이 협업한다면 그것도 쉽지 않다. 이런 문제를 해결하기 위해 실험 관리(추적) 도구를 사용하며 대표적으로는 MLflow, W&B가 있다. 
정확한 실험 추적을 통해 실험의 재현성을 갖춰야 추가 실험으로 인한 낭비를 막을 수 있다.  
  
# **모델 저장소**  
![img.png](image/img5.png)  
  
MLOps에서 모델 저장소(model registry)는 머신러닝 모델을 체계적으로 관리하고 버전 제어하는 데 필수적인 요소다. 머신러닝 모델 개발 과정에서 
위 그림과 같이 여러 머신러닝 파이프라인에서 다양한 실험을 통해 여러 버전의 모델이 생성되는데 모델 저장소를 활용하면 다양한 모델을 하나로 통합해서 
관리할 수 있다. 모델 저장소를 사용하면 모델의 전체 수명 주기를 추적하고 관리할 수 있고 모델의 변경 이력을 기록하기 때문에 모델에 문제가 발생하는 
경우 빠르게 이전 버전으로 되돌릴 수 있게 해준다. 또한 모델의 메타 데이터(모델 생성이, 성능 지표, 하이퍼파라미터 등)를 저장하여 모델에 대한 중요한 
정보를 쉽게 확인할 수 있도록 한다. 모델 저장소와 연동하여 모델을 서빙하고 배포하는 과정을 자동화할 수 있어 모델의 배포와 관리가 간소화된다. 그뿐 아니라 
모델 저장소는 데이터 과학자와 엔지니어 간의 협업을 촉진하여 팀 내 커뮤니케이션을 원활하게 한다. 대표적인 모델 저장소 도구로는 MLflow 모델 저장소, 
AWS 세이지메이커(Sagemaker) 모델 저장소 등이있다.  
  
# **모델 모니터링**  
머신러닝 모델이 실제 환경에 배포된 이후에도 지속적으로 의도한 대로 작동하는지 모니터링하는 것은 매우 중요하다. 머신러닝 모델은 학습 데이터를 통해 
학습한 패턴을 바탕으로 예측을 수행하기 때문에 정상적으로 요청에 응답하고 있다고 하더라도 엉뚱한 값을 반환한 것은 아닌지 확인해야 한다. 특히 학습한 
이후 오랜 시간이 흘렀다면 입력 데이터의 변동으로 인해 모델의 성능 저하가 발생할 수 있다. 따라서 이런 문제를 빠르게 발견하고 대응할 수 있도록 
모니터링을 수행해야 한다. 예를 들어 리뷰가 긍정적인지 부정적인지 분류하는 모델을 개발했다고 하자. 모델을 배포한 이후에 서비스를 방문하는 사람들의 
직무 분야, 연령대, 성별 등 분포에 변화가 생긴다면 사용하는 표현, 리뷰의 길이 들 데이터가 모델을 학습시켰을 때와 달라질 수 있다. 머신러닝 모델은 
일반화 성능이 높도록 학습하지만 학습 데이터와 비슷한 데이터 분포에서 가장 좋은 성능을 보인다. 따라서 모델 배포 이후에 입력 데이터에 변화가 생기지는 
않는지 유심히 삺봐야 한다. 또한 운영 과정에서 배포된 모델이 바뀌지는 않았는지 모델의 버전도 확인해야 한다.  
  
머신러닝 모델의 성능뿐만 아니라 머신러닝 시스템의 기본적인 지표(예: CPU 및 GPU 사용량, 지연 시간 등)를 기록해 시스템에 문제가 없는지, 추가적인 
리소스의 확보가 필요한지, 리소스에 낭비는 없는지 지속적인 확인이 필요하다. 대표적인 모니터링 도구로는 오픈소스인 프로메테우스(Prometheus)와 
그라파나(Grafana)가 있고 AWS 세이지메이커의 모델 모니터(Model Monitor)와 같은 관리형 서비스도 있다. 모니터링 도구를 활용해 입력 데이터부터 모델 
예측값, 시스템 성능까지 전방위적으로 모니터링함으로써 모델의 성능 저하를 조기에 포착하고 신속히 조치를 취할 수 있다.  
  
